pico-8 cartridge // http://www.pico-8.com
version 38
__lua__
angle=0
power=10
player_x=64
player_y=64
aim_x=0
aim_y=0
aim_length=40
state=0
rock_x=0
rock_y=0
rock_visible=0
rock_z=0
rock_vel_h=0
rock_vel_v=0
gravity=.25

function _update()
	if state==0 then
		update_aim()
	elseif state==1 then
		update_throw()
	elseif state==2 then
		update_run_to_rock()
	end
end

function update_aim()
	if btn(⬅️) then
		angle+=0.01	
	end
	if btn(➡️) then
		angle-=0.01	
	end
	if btn(❎) then
		rock_visible=1
		rock_vel_h=power/2
		rock_vel_v=-power/5
		rock_angle=angle
		rock_z=0
		rock_x=player_x
		rock_y=player_y
		state=1
	end
	aim_x=cos(angle)*aim_length+player_x
	aim_y=sin(angle)*(aim_length/2)+player_y
end

function update_throw()
	rock_z+=rock_vel_v
	rock_x=cos(rock_angle)*rock_vel_h+rock_x
	rock_y=sin(rock_angle)*(rock_vel_h/2)+rock_y
	rock_vel_v+=gravity
	if rock_z==0 then
		rock_x=flr(rock_x)
		rock_y=flr(rock_y)
		state=2
	end
end

function update_run_to_rock()
	if player_x==rock_x
	and player_y==rock_y then
		aim_x=player_x
		aim_y=player_y
		rock_visible=0
		state=0
	end
	
	if player_x>rock_x then
		player_x-=1
	end
	if player_x<rock_x then
		player_x+=1
	end
	if player_y>rock_y then
		player_y-=1
	end
	if player_y<rock_y then
		player_y+=1
	end
--		local run_angle=atan2((rock_y-player_y)/(player_x-rock_x))
--		player_x+=cos(run_angle)*.5
--		player_y+=sin(run_angle)*.5	
end

function _draw()
	cls(1)
 draw_tiles()
 
 if state==0 then
	 line(
	 	player_x,
	 	player_y,
	 	aim_x,
	 	aim_y
	 )
	 -- aim sprite
	 spr(
	 	0x10,
	 	aim_x-4,
	 	aim_y-4
	 )
 end
 -- player sprite
 spr(
 	3,
 	player_x-8,
 	player_y-15,
 	2,
 	2
 )

 if rock_visible==1 then
 	-- rock shadow
 	spr(
 		32,
 		rock_x-4,
 		rock_y-4
 	)
 	-- rock sprite
 	spr(
 		0,
 		rock_x-4,
 		rock_y-4+rock_z
 	)
 end

end
-->8
-- tiles

function draw_tiles()
	for y = 0,30,1 do
		if y%2==0 then
			offset=0
		else
			offset=8
		end
		for x = 0,7,1 do
			tile=1
			spr(tile,x*16+offset,y*4)
			spr(tile+1,x*16+offset+8,y*4)
		end
	end
end
__gfx__
00000000000000bb0000000000000444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000666d00000bb335500000000004444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00666ddd00bb333333550000000444ff444440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0666ddddbb333333333355000004fff44fff40000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6666ddddbb33333333335500000eff0ff0ffe0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
666666dd00bb3333335500000000ffffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
006666dd0000bb33550000000000ffff0fff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000bb00000000000000ffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000888888000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07077070000000000000000000008888888800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000088888888880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07077070000000000000000000ff0111111dff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07077070000000000000000000f00110011ddf000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000110011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707707000000000000000000000ccc00ccc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000ccc00ccc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
11111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
